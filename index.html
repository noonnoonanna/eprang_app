<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#ffffff" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="style.css" />
  <title>IpiCare</title>
</head>
<body>
  <div class="app">
    <header>
      <div class="bar">        
        <h1>IpiCare</h1>
      </div>
    </header>

    <main>
      <!-- 0) 인트로 -->
      <section id="view-intro" class="view active">
        <div class="intro">
          <h2>
            <span class="line">나만을 위한 맞춤 건강,</span>
            <span class="line">자연이 길러주는 나만의 건강 루틴</span>
          </h2>
          <div class="intro-actions">
            <button class="btn acc" onclick="navigate('terms')">시작하기</button>
			<div class="login-text">
				이미 계정이 있나요?<span class="login-link" onclick="navigate('login')">로그인</span>
			</div>
          </div>
        </div>
      </section>
	  
	  <!-- 로그인 -->
	  <section id="view-login" class="view">
  <div class="grid">
    <div class="card pad">
      <div class="title-strong">로그인</div>
      <form id="form-login" onsubmit="handleLogin(event)">
        <label>
          <input type="text" name="userid" required placeholder="아이디" autocomplete="username">
        </label>
        <label>
          <input type="password" name="password" required placeholder="비밀번호" autocomplete="current-password">
        </label>
        <div class="cols two" style="margin-top:8px">
          <button type="button" class="btn ghost" onclick="navigate('intro')">이전</button>
          <button type="submit" class="btn acc">로그인</button>
        </div>
      </form>
    </div>

    <div class="card pad hint">
      아직 계정이 없나요?
      <span class="login-link" onclick="navigate('terms')">회원가입</span>
    </div>
  </div>
</section>

      <!-- 1) 약관 동의 -->
      <section id="view-terms" class="view">
        <div class="grid">
          <div class="card pad">
            <label class="agree-row"><input type="checkbox" id="agreeAll" onchange="toggleAllAgreements(this.checked)"><label for="agreeAll"><b>전체 약관 동의</b></label></label>
          </div>
          <div class="card pad">
            <div class="grid">
              <div class="agree-row">
                <input type="checkbox" id="agreeService" onchange="syncAllAgree()">
                <div class="grow"><label for="agreeService" class="grow">서비스 이용약관 (필수)</label></div>
                <button type="button" class="btn ghost" onclick="openTerms('서비스 이용약관', TERMS.service)">〉</button>
              </div>
              <div class="agree-row">
                <input type="checkbox" id="agreePrivacy" onchange="syncAllAgree()">
                <div class="grow"><label for="agreePrivacy" class="grow">개인정보 수집 및 이용동의 (필수)</label></div>
                <button type="button" class="btn ghost" onclick="openTerms('개인정보 수집 및 이용동의', TERMS.privacy)">〉</button>
              </div>
            </div>
          </div>
          <div class="card pad">
            <div class="cols two">
              <button class="btn ghost" onclick="navigate('intro')">이전</button>
              <button id="btnTermsNext" class="btn acc" disabled onclick="navigate('basic')">다음</button>
            </div>
          </div>
        </div>
      </section>

      <!-- 2) 기본 정보 -->
	<section id="view-basic" class="view">
		<div class="grid">
		  <div class="card pad">
		    <div class="title-strong">기본 정보</div>
			<form id="form-basic" onsubmit="event.preventDefault(); saveBasic();">
			
			<!-- ✅ 아이디: 영문, 숫자, 특수기호(_ @)만 가능 -->
			<label>아이디
				<div class="cols dup">
					<input name="userid" id="userid" required minlength="4" maxlength="16" pattern="^[A-Za-z0-9_@]+$" placeholder="영문, 숫자, _ @만 사용 가능" title="아이디는 영문, 숫자, _ @만 사용할 수 있습니다."
						inputmode="latin" autocapitalize="off" autocomplete="username" utocorrect="off" spellcheck="false" onbeforeinput="blockDisallowed(event)" oninput="filterUserId(this)" oncompositionend="filterUserId(this)" />
					<button type="button" class="btn" onclick="checkIdDup()">중복체크</button>
				</div>
				<span id="idHint" class="hint"></span>
			</label>
	
			<!-- ✅ 비밀번호: 8자 이상, 특수문자 포함 -->
			<label>비밀번호
				<input name="pw" id="pw" type="password" required minlength="8" oninput="validatePwSeq()" onblur="validatePwSeq()" placeholder="8자 이상, 특수기호 1개 이상 포함" title="8자 이상이며, 특수기호(!@#$%^&*)를 1개 이상 포함해야 합니다.">
			</label>
	
			<label>비밀번호 확인
			<input name="pw2" id="pw2" type="password" required minlength="8" oninput="validatePwSeq()" onblur="validatePwSeq()">
			<span id="pwHint" class="hint"></span>
			</label>
	
			<!-- ✅ 닉네임 / 연락처 -->
			<label>닉네임<input name="nick" required maxlength="10"></label>
	
			<!-- 연락처: 숫자만 허용 -->
			<label>연락처
				<input name="phone" id="phone" required pattern="^[0-9]{10,11}$" maxlength="11" placeholder="01012345678" title="숫자만 입력 가능합니다. (- 제외)" oninput="filterPhone(this)" inputmode="numeric">
			</label>
	
			<!-- ✅ 성별 / 생년월일 -->
			<label>성별
			<select name="gender" required>
				<option value="">선택</option>
				<option>여성</option>
				<option>남성</option>
			</select>
			</label>
	
			<label>생년월일<input name="birth" type="date" required></label>
	
			<!-- ✅ 키 / 체중 -->
			<div class="cols two">
			<label>키(cm)<input type="number" name="height" min="50" max="250" step="0.1" required></label>
			<label>체중(kg)<input type="number" name="weight" min="10" max="250" step="0.1" required></label>
			</div>
		</form>
		</div>
	
		<div class="card pad">
		<div class="cols two">
			<button class="btn ghost" onclick="navigate('terms')">이전</button>
			<button class="btn acc" onclick="saveBasic()">다음</button>
		</div>
		</div>
	</div>
	</section>



      <!-- 3) 온보딩 설문 -->
	<section id="view-survey" class="view">
		<div class="grid">
			<div class="card pad">
				<div class="title-strong">건강 목표</div>
				<form id="form-survey">
					<div class="goal-buttons">
						<input type="checkbox" id="goal-sleep" name="goals" value="sleep">
						<label for="goal-sleep">수면</label>
				
						<input type="checkbox" id="goal-stress" name="goals" value="stress">
						<label for="goal-stress">스트레스</label>
				
						<input type="checkbox" id="goal-digestion" name="goals" value="digestion">
						<label for="goal-digestion">소화</label>
				
						<input type="checkbox" id="goal-focus" name="goals" value="focus">
						<label for="goal-focus">집중</label>
												
						<input type="checkbox" id="goal-calm" name="goals" value="calm">
						<label for="goal-calm">진정</label>
						
						<input type="checkbox" id="goal-core" name="goals" value="core">
						<label for="goal-core">기본</label>
					</div>
					
					<label>생활습관/메모
					<textarea name="habit" placeholder="예: 야근 잦음, 카페인 민감"></textarea>
					</label>
				
					<label>식품 알레르기/금기 (쉼표 구분)
					<input name="allergies" placeholder="예: 견과류, 카페인">
					</label>
				
					<label>복용 중인 성분(있는 경우)
					<input name="intakes" placeholder="예: 멜라토닌, 유산균">
					</label>
				</form>
			</div>
		
			<div class="card pad">
				<div class="cols two">
					<button class="btn ghost" onclick="navigate('basic')">이전</button>
					<button class="btn acc" onclick="saveSurvey()">저장하고<br>추천 작물 보기</button>
				</div>
			</div>
		</div>
	</section>


      <!-- 4) 추천 작물 소개 -->
      <section id="view-reco-intro" class="view">
        <div class="grid">
          <div class="card pad" id="recoIntroCard"></div>
		  <div class="view-reco-intro-actions">
			<button class="btn acc" onclick="navigate('home')">완료</button>
		  </div>
		</div>
      </section>

      <!-- 5) 홈 -->
      <section id="view-home" class="view">
        <div class="grid">
          <div class="card pad" id="heroReco"></div>
          <div class="card pad">
            <div class="title-strong">내 작물 상태</div>
            <div id="myCrops" class="list" style="margin-top:8px"></div>
          </div>
          <div class="card pad">
            <div class="title-strong">바로가기</div>
            <div class="icons">
              <button class="btn" onclick="navigate('survey')">🎯 건강 목표</button>
              <button class="btn" onclick="navigate('recipes')">🍵 레시피</button>
              <button class="btn" onclick="navigate('grow')">⏰ 리마인더</button>
              <button class="btn" onclick="navigate('my')">🧾 구독</button>
              <button class="btn" onclick="toast('오늘 브리핑 준비중')">📣 일일브리핑</button>
              <button class="btn" onclick="navigate('my')">⚙️ 설정</button>
            </div>
          </div>
          <div class="card pad"><div class="disclaimer">의료 고지: 본 서비스는 진단/치료/처방이 아닙니다. 증상이 지속되면 전문의 상담을 권장합니다.</div></div>
        </div>
      </section>

      <!-- 6) 기록: 캘린더 -->
      <section id="view-records" class="view">
        <div class="card pad cal">
          <div class="cal-nav"><button class="btn" onclick="prevMonth()">이전</button><div id="calTitle" class="title-strong"></div><button class="btn" onclick="nextMonth()">다음</button></div>
          <div class="cal-head"><div>월</div><div>화</div><div>수</div><div>목</div><div>금</div><div>토</div><div>일</div></div>
          <div id="calGrid" class="cal-grid"></div>
        </div>
      </section>

      <!-- 7) 추천/원물/생육 -->
      <section id="view-reco" class="view">
        <div class="grid">
          <div class="card pad">
            <div class="title-strong">추천 가이드</div>
            <div id="recoDetail" class="hint" style="margin-top:6px"></div>
          </div>
          <div class="card pad"><button class="btn" onclick="navigate('plants')">추천 원물 보기</button></div>
        </div>
      </section>
      <section id="view-plants" class="view"><div id="plantList" class="grid"></div><div class="card pad"><button class="btn" onclick="navigate('grow')">생육 방법 보기</button></div></section>
      <section id="view-grow" class="view"><div id="growTips" class="grid"></div><div class="card pad"><div class="title-strong">교체·수확 시점 알림(데모)</div><div class="hint">브라우저 알림 권한이 필요합니다.</div><div class="cols two"><button class="btn" onclick="reqNotifyPerm()">알림 권한 요청</button><button class="btn acc" onclick="demoSchedule()">3초 뒤 알림 테스트</button></div></div></section>

      <!-- 8) 레시피 (탭은 없음, 홈 아이콘으로 접근) -->
      <section id="view-recipes" class="view"><div class="grid">
        <div class="card pad"><div class="title-strong">숏폼 레시피 (1–2분)</div>
          <div class="list">
            <div class="item"><div class="meta"><div class="title">레몬밤 티 1분</div><div class="sub">뜨거운 물 200ml + 레몬밤 잎 5~7장</div></div><button class="btn" onclick="toast('레시피 저장됨')">저장</button></div>
            <div class="item"><div class="meta"><div class="title">인퓨즈드 워터</div><div class="sub">물 500ml + 허브 6장 + 레몬</div></div><button class="btn" onclick="toast('레시피 저장됨')">저장</button></div>
            <div class="item"><div class="meta"><div class="title">바질 샐러드</div><div class="sub">바질 + 토마토 + 올리브오일</div></div><button class="btn" onclick="toast('레시피 저장됨')">저장</button></div>
          </div>
        </div>
      </div></section>

      <!-- 9) 마이 -->
      <section id="view-my" class="view">
        <div class="grid">
          <div class="card pad">
            <div class="profile-head">
              <div class="avatar"></div>
              <div>
                <div class="hint">안녕하세요!</div>
                <div id="myNick" class="nick" onclick="openProfileEdit()">닉네임</div>
              </div>
              <div class="grow"></div>
              <button class="btn" onclick="openProfileEdit()">프로필 수정</button>
            </div>
          </div>
          <div class="card pad">
            <div class="title-strong">설정</div>
            <div class="list" style="margin-top:8px">
              <label class="item"><div class="meta"><div class="title">건강 데이터 사용 동의</div><div class="sub">추천 정확도 향상</div></div><input type="checkbox" id="ck-use-health" onchange="toggleConsent('use_health', this.checked)"></label>
              <label class="item"><div class="meta"><div class="title">리마인더 알림 동의</div><div class="sub">교체·수확·섭취 시점 알림</div></div><input type="checkbox" id="ck-remind" onchange="toggleConsent('reminder', this.checked)"></label>
              <div class="item"><div class="meta"><div class="title">데이터 내보내기</div><div class="sub">JSON 파일로 저장</div></div><button class="btn" onclick="exportData()">내보내기</button></div>
            </div>
          </div>
        </div>
      </section>

      <!-- 10) 작물 상세 관리 -->
      <section id="view-crop-detail" class="view">
        <div class="grid">
          <div class="card pad" id="cropHeader"></div>
          <div class="card pad">
            <div class="title-strong">재배 메타</div>
            <div class="cols two"><label>배송일<input type="date" id="shipDate"></label><label>심은 날<input type="date" id="plantDate"></label></div>
            <div class="right"><button class="btn" onclick="saveCropMeta()">저장</button></div>
          </div>
          <div class="card pad">
            <div class="row-between"><div class="title-strong">일자별 관리 로그</div><button class="btn" onclick="openLogModal()">로그 추가</button></div>
            <div id="cropLogs" class="grid" style="margin-top:8px"></div>
          </div>
          <div class="card pad"><button class="btn ghost" onclick="navigate('home')">뒤로</button></div>
        </div>
      </section>

      <!-- 모달/오버레이 -->
      <div id="overlay" class="overlay" onclick="closeModal(event)"></div>
      <div id="modal" class="modal" style="display:none"></div>
      <div id="recOverlay" class="overlay"></div>
      <div id="recModal" class="modal" style="display:none"></div>
    </main>

    <nav class="tabs hidden">
      <ul>
        <li><button id="tab-home" class="active" onclick="navigate('home')">🏠<small>홈</small></button></li>
        <li><button id="tab-records" onclick="navigate('records')">📝<small>기록</small></button></li>
        <li><button id="tab-reco" onclick="navigate('reco')">✨<small>추천</small></button></li>
        <li><button id="tab-my" onclick="navigate('my')">👤<small>마이</small></button></li>
      </ul>
    </nav>
  </div>

  <div id="toast" class="toast">저장되었습니다</div>

  <script src="app.js"></script>
</body>
</html>
