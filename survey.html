<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#ffffff" />
  <title>IpiCare — 설문(패치 미리보기)</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body data-page="survey">
  <div class="app">
    <header>
      <div class="bar">
        <h1 style="cursor:pointer"><a href="intro.html" style="all:unset;cursor:pointer">IpiCare</a></h1>
      </div>
    </header>

    <!-- ▼▼▼ 여기부터 교체(main) ▼▼▼ -->
    <main id="surveyWizard">
      <style>
        /* --- Patch-only styles (scoped to #surveyWizard) --- */
        #surveyWizard { width: 380px; display: grid; gap: 14px; margin: 0 auto; }
        #surveyWizard .card { background: var(--card, #fff); border: 1px solid var(--line, #e5e7eb); border-radius: 14px; box-shadow: 0 2px 10px rgba(22,163,74,.05); padding: 16px; }
        #surveyWizard .subhead { font-weight: 700; margin: 14px 0 8px; }
        #surveyWizard .checklist { display: grid; gap: 8px; }
        #surveyWizard .checklist label { display: flex; align-items: center; gap: 10px; padding: 12px 14px; border: 1px solid var(--line, #e5e7eb); border-radius: 12px; background: #fff; cursor: pointer; transition: .15s; }
        #surveyWizard .checklist label:hover { border-color: #cfeede; background: #f8fffb; }

        /* Progress bar */
        #surveyWizard .progress .track { height: 8px; background: #ecfdf5; border: 1px solid #d1fae5; border-radius: 999px; overflow: hidden; }
        #surveyWizard .progress .bar { height: 100%; width: 0%; background: var(--green, #16a34a); transition: width .25s ease; }

        /* Custom checkbox (stronger, visible) */
        #surveyWizard .checklist input[type="checkbox"]{
          -webkit-appearance: none; appearance: none;
          width: 22px; height: 22px; border-radius: 6px;
          border: 2px solid #b7e6c9; background: #fff;
          display: inline-grid; place-items: center;
          transition: all .2s ease-in-out; position: relative;
        }
        #surveyWizard .checklist input[type="checkbox"]:checked{
          border-color: var(--green, #16a34a);
          background: var(--green, #16a34a);
          box-shadow: 0 0 0 3px rgba(22,163,74,.18);
        }
        #surveyWizard .checklist input[type="checkbox"]:checked::after{
          content: "✔"; color: #fff; font-size: 14px; font-weight: 800;
          position: absolute; left: 50%; top: 50%; transform: translate(-50%,-55%);
        }

        /* Inputs */
        #surveyWizard select, #surveyWizard input[type="text"], #surveyWizard textarea{
          width: 100%; border: 1px solid var(--line, #e5e7eb); border-radius: 10px; padding: 10px 12px; background: #fff; outline: none;
        }

        /* Buttons */
        #surveyWizard .cols { display: grid; gap: 8px; }
        #surveyWizard .two { grid-template-columns: 1fr 1fr; }
        #surveyWizard .btn { padding: 12px 14px; border-radius: 10px; border: 1px solid var(--line, #e5e7eb); background: #fff; font-weight: 700; cursor: pointer; }
        #surveyWizard .btn.acc { background: var(--green, #16a34a); color: #fff; border-color: var(--green, #16a34a); }
        #surveyWizard .btn.acc:hover { background: #15803d; }
      </style>

      <!-- 진행바 -->
      <section class="card progress">
        <div class="track"><div class="bar" id="progressBar"></div></div>
      </section>

      <form id="surveyForm">
        <div class="card step" data-step="0">
          <div class="subhead">A. 요즘 나의 건강 상태 <small class="hint">(최대 3개 선택)</small></div>
          <div class="checklist" id="symptomList">
            <label><input type="checkbox" name="symptom" value="sleep_bad" /> 잠이 잘 안 와요</label>
            <label><input type="checkbox" name="symptom" value="stress_high" /> 스트레스가 많아요</label>
            <label><input type="checkbox" name="symptom" value="focus_low" /> 집중이 잘 안 돼요</label>
            <label><input type="checkbox" name="symptom" value="digest_heavy" /> 식후에 더부룩해요</label>
            <label><input type="checkbox" name="symptom" value="tired" /> 몸이 자주 피곤해요</label>
          </div>
          <p class="hint" id="symptomCountHint">0/3 선택됨</p>
        </div>

        <div class="card step" data-step="1">
          <div class="subhead">B. 식습관</div>
          <div class="checklist">
            <label><input type="checkbox" name="habit" value="snack" /> 야식을 자주 먹어요</label>
            <label><input type="checkbox" name="habit" value="sweet" /> 단맛을 자주 찾아요</label>
            <label><input type="checkbox" name="habit" value="fast_eat" /> 식사 속도가 빨라요</label>
            <label><input type="checkbox" name="habit" value="coffee" /> 커피/카페인을 자주 마셔요</label>
          </div>
        </div>

        <div class="card step" data-step="2">
          <div class="subhead">C. 향·맛 취향</div>
          <select name="flavor_pref">
            <option value="soft">부드럽고 순한 향</option>
            <option value="fresh">상쾌한 향</option>
            <option value="strong">허브 향 강한 편</option>
          </select>
        </div>

        <div class="card step" data-step="3">
          <div class="subhead">D. 피해야 할 것 (선택)</div>
          <div class="checklist">
            <label><input type="checkbox" name="avoid" value="strong_scent" /> 향이 강한 식물은 부담</label>
            <label><input type="checkbox" name="avoid" value="mint_family" /> 민트 계열은 피하고 싶음</label>
          </div>
          <label>기타 제외(콤마로 구분)
            <input type="text" name="avoid_manual" placeholder="예: 루꼴라, 타임" />
          </label>
        </div>

        <div class="card step" data-step="4">
          <div class="subhead">E. 식품 알레르기 / 금기 (선택)</div>
          <div class="checklist"><label><input type="checkbox" name="allergy_flag" /> 허브/향신료 알레르기가 있어요</label></div>
          <label>알레르기/금기 목록 (콤마로 구분)
            <input name="allergy_list" placeholder="예: 카모마일, 민트, 루꼴라" />
          </label>
        </div>

        <div class="card step" data-step="5">
          <div class="subhead">F. 복용 중인 성분 (선택)</div>
          <label>현재 복용 중인 성분/추출물 (콤마로 구분)
            <textarea name="intake_list" rows="2" placeholder="예: 오메가3, 비타민D, 멜라토닌, 카페인"></textarea>
          </label>
        </div>
      </form>

      <section class="card">
        <div class="cols two">
          <button class="btn ghost" id="btnPrev" type="button">이전</button>
          <button class="btn acc" id="btnNext" type="button">다음</button>
        </div>
      </section>
    </main>
    <!-- ▲▲▲ 여기까지 교체(main) ▲▲▲ -->

  </div>
  <script src="app.js" defer></script>
  <script defer>
    (function(){
      const steps = document.querySelectorAll('#surveyWizard .step');
      const total = steps.length;
      let step = 0;

      const bar = document.querySelector('#surveyWizard #progressBar');
      const prevBtn = document.querySelector('#surveyWizard #btnPrev');
      const nextBtn = document.querySelector('#surveyWizard #btnNext');

      function updateView() {
        steps.forEach((s, i) => s.style.display = (i === step ? 'block' : 'none'));
        if (bar) bar.style.width = (((step + 1) / total) * 100) + '%';
        if (prevBtn) prevBtn.disabled = (step === 0);
        if (nextBtn) nextBtn.textContent = (step === total - 1) ? '저장하고 추천 보기' : '다음';
      }

      if (prevBtn) prevBtn.addEventListener('click', function(){
        if (step > 0) step--;
        updateView();
      });

      if (nextBtn) nextBtn.addEventListener('click', function(){
        if (step < total - 1) step++;
        else if (typeof window.saveSurvey === 'function') window.saveSurvey();
        else saveSurvey() //alert('미리보기: 설문 완료');
        updateView();
      });

      // A-step UX: 3개 제한
      const boxes = document.querySelectorAll('#surveyWizard #symptomList input[type="checkbox"]');
      const hint = document.getElementById('symptomCountHint');
      function updateSymptom(){
        if (!boxes.length) return;
        const cnt = Array.from(boxes).filter(b=>b.checked).length;
        if (hint) hint.textContent = cnt + '/3 선택됨';
        if (cnt >= 3){
          boxes.forEach(b=>{ if(!b.checked){ b.disabled = true; b.parentElement.style.opacity = .6; } });
        } else {
          boxes.forEach(b=>{ b.disabled = false; b.parentElement.style.opacity = 1; });
        }
      }
      boxes.forEach(b => b.addEventListener('change', updateSymptom));
      updateSymptom();

      updateView();
    })();
  </script>
</body>
</html>
